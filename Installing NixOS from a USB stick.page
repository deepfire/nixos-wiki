Using Unetbootin
----------------

It is possible to install NixOS from a USB stick, rather than from a CD.
This is useful if you want to install NixOS on a machine that doesn't
have a CD-ROM drive (such as most netbooks), or if you don't want to
waste a blank CD. Here is how to do it:

1.  Download a [NixOS ISO image](http://nixos.org/nixos/download.html)
    or [create a custom ISO](//Creating a Nix OS live CD).
2.  Obtain a USB stick formatted with the VFAT/FAT32 filesystem with
    enough free disk space to hold the contents of the ISO image. Note
    that it's not necessary to erase the USB stick.
3.  Install [UNetbootin](http://unetbootin.sourceforge.net/), a tool
    that allows you to create a bootable USB stick from an ISO image.
    UNetbootin runs on both Linux and Windows. If you already have
    Nix/NixOS, you can install it by running `nix-env -i unetbootin`.
    [Other
    tools](http://en.wikipedia.org/wiki/List_of_tools_to_create_Live_USB_systems)
    may also work.
4.  Insert the USB stick, start UNetbootin, select the ISO file and
    target USB drive, and press Ok. This copies the contents of the ISO
    to the USB stick and installs the GRUB boot loader.
5.  You should now be able to boot NixOS from the USB stick, and perform
    the installation as usual.

Using syslinux
--------------

If you have trouble booting from a USB drive or sdcard with Unetbootin
(I just got a blinking cursor instead of a bootloader on an Asus eee
1000) the procedure described on
<http://www.knoppix.net/wiki/Bootable_USB_Key> should work. After
preparing the sdcard with mkdiskimage and syslinux you can mount it and
copy all the content from the NixOS iso:

    $ mount -o loop ~/Downloads/nixos-graphical-0.1pre27337-i686-linux.iso /media/iso
    $ rsync -av --progress /media/iso/ /media/sd-card/

The syslinux.cfg needs to be created manually, but the details can
easily be derived from the grub.cfg on the NixOS install cd.

I specified the root device by UUID, to get the UUID:

    blkid /dev/mmcblk0p1

The relevant section from the live cd: /media/sd-card/boot/grub/grub.cfg

    menuentry "NixOS Installer / Rescue" {
      linux /boot/bzImage init=/nix/store/r7xhnzymi1ll49r4glf1dwr5y1alx0bl-system/init root=LABEL=NIXOS_INSTALL_CD_0.1pre27337 splash=verbose vga=0x317
      initrd /boot/initrd
    }

can be used in the syslinux config file: /media/sd-card/syslinux.cfg
(you should just need to update the init path and the root UUID / LABEL
or device path)

    DEFAULT linux
    LABEL linux
      SAY Now booting the kernel from SYSLINUX...
      KERNEL /boot/bzImage
      APPEND init=/nix/store/r7xhnzymi1ll49r4glf1dwr5y1alx0bl-system/init root=UUID=509C-63E2 ro initrd=/boot/initrd splash=verbose
